<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>êµê°€ë•Œë¦¬ê¸° ê²Œì„í•˜ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    /* ... (ê¸°ì¡´ CSS ìœ ì§€) ... */
  </style>
</head>
<body>
  <h1>êµê°€ë•Œë¦¬ê¸° ê²Œì„í•˜ê¸°</h1>
  <p class="note">â€» ê²Œì„ì´ ì›í™œí•˜ì§€ ì•Šì„ ì‹œ í€ì¹˜ ì†ë„ë¥¼ ì¤„ì´ê±°ë‚˜ ë‹¤ì‹œ ì‹œì‘ì„ ëˆ„ë¥´ì„¸ìš”.</p>
  
  <p>í€ì¹˜ íšŸìˆ˜: <span id="count">0</span></p>
  <img id="enemy" src="images/clean.png">
  <br>
  <button onclick="resetGame()">ë‹¤ì‹œ ì‹œì‘</button>
  <p id="message"></p>

  <div id="ranking">
    <h2>ğŸ† TOP 10 ë­í‚¹ ğŸ†</h2>
    <table id="rankingTable">
      <thead>
        <tr>
          <th>ìˆœìœ„</th>
          <th>ê¸°ë¡</th>
          <th>ì´ë‹ˆì…œ</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="close" onclick="closeRanking()">ë‹«ê¸°</div>
  </div>

  <audio id="punchsound" src="sounds/punchsound.wav"></audio>
  <audio id="hitsound1" src="sounds/hitsound1.wav"></audio>
  <audio id="hitsound2" src="sounds/hitsound2.wav"></audio>
  <audio id="hitsound3" src="sounds/hitsound3.wav"></audio>

  <!-- â˜… 1. Firebase SDK ì¶”ê°€ -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

  <script>
    // â˜… 2. Firebase êµ¬ì„± (ë³¸ì¸ í”„ë¡œì íŠ¸ ì„¤ì •ìœ¼ë¡œ ëŒ€ì²´)
    const firebaseConfig = {
      apiKey: "AIzaSyAZtWpPgmhr5sKY3lIyzYf1sreyF7SzhcU",
      authDomain: "punchgyogaserver.firebaseapp.com",
      databaseURL: "https://punchgyogaserver-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "punchgyogaserver",
      storageBucket: "punchgyogaserver.firebasestorage.app",
      messagingSenderId: "551738104836",
      appId: "1:551738104836:web:f0e1d90e748ddb8740a951",
      measurementId: "G-FMP1XFT90H"
    };
    firebase.initializeApp(firebaseConfig);

    // â˜… 3. ê¸°ì¡´ ë³€ìˆ˜ ìœ ì§€
    let count = 0;
    let startTime = null;
    let endTime = null;
    const enemy = document.getElementById("enemy");
    const countText = document.getElementById("count");
    const message = document.getElementById("message");
    const rankingTable = document.getElementById("rankingTable").getElementsByTagName('tbody')[0];

    // â˜… 4. Firebase ì—°ë™ í•¨ìˆ˜
    async function saveRecord(elapsed, initials) {
      const db = firebase.database();
      await db.ref('records').push({
        time: elapsed,
        initials: initials,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
    }

    function loadRecords() {
      const db = firebase.database();
      db.ref('records')
        .orderByChild('time')
        .limitToLast(10)
        .once('value', (snapshot) => {
          const records = [];
          snapshot.forEach((child) => {
            records.push(child.val());
          });
          displayRecords(records.reverse());
        });
    }

    function displayRecords(records) {
      rankingTable.innerHTML = '';
      records.forEach((record, index) => {
        const row = rankingTable.insertRow();
        row.insertCell(0).textContent = index + 1;
        row.insertCell(1).textContent = record.time.toFixed(2) + 'ì´ˆ';
        row.insertCell(2).textContent = record.initials || 'ìµëª…';
      });
    }

    // â˜… 5. punch() í•¨ìˆ˜ ìˆ˜ì • (async ì¶”ê°€)
    async function punch() {
      if (count >= 10) return;
      if (count === 0) startTime = performance.now();

      count++;
      countText.innerText = count;

      document.getElementById("punchsound").play();

      const randSide = Math.random() < 0.5 ? 'L' : 'R';
      let state = '';

      if (count >= 10) {
        endTime = performance.now();
        const elapsed = (endTime - startTime) / 1000;

        // â˜… Firebaseì— ê¸°ë¡ ì €ì¥
        const initials = prompt(`ğŸ‰ ${elapsed.toFixed(2)}ì´ˆ ê¸°ë¡!\nì´ë‹ˆì…œ ì…ë ¥ (ì˜ë¬¸ 3ì):`);
        if (initials) {
          await saveRecord(elapsed, initials.substring(0, 3).toUpperCase());
          loadRecords();
        }

        message.innerHTML = `ê¸°ë¡: ${elapsed.toFixed(2)}ì´ˆ<br>
                           <a href="https://youtu.be/88hvuiZewfA" target="_blank" style="color: yellow;">â–¶ ëª…ë°˜ [ì—½ê¸°] ë“¤ìœ¼ëŸ¬ ê°€ê¸°</a>`;
        enemy.src = 'images/over.png';
        return;
      }
      // ... (ê¸°ì¡´ ì• ë‹ˆë©”ì´ì…˜ ë¡œì§ ìœ ì§€)
    }

    // â˜… 6. í˜ì´ì§€ ë¡œë“œ ì‹œ ë­í‚¹ ë¶ˆëŸ¬ì˜¤ê¸°
    window.onload = function() {
      loadRecords();
    };

    // ê¸°ì¡´ í•¨ìˆ˜ë“¤ ìœ ì§€
    function closeRanking() {
      document.getElementById("ranking").style.display = 'none';
    }

    function resetGame() {
      count = 0;
      startTime = null;
      countText.innerText = count;
      message.innerText = "";
      enemy.src = 'images/clean.png';
    }

    enemy.addEventListener('click', punch);
  </script>
</body>
</html>
